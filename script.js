// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
const tg = window.Telegram.WebApp;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
tg.ready();
tg.expand();
tg.enableClosingConfirmation();

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–º–Ω—ã–π —Ü–≤–µ—Ç —Ñ–æ–Ω–∞
tg.setHeaderColor('#000000');
tg.setBackgroundColor('#000000');

// –¢–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
let currentPage = 'home';
let isAnimating = false;

// –ö—ç—à–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
const elements = {
    content: document.getElementById('content'),
    title: document.getElementById('pageTitle'),
    description: document.getElementById('pageDescription'),
    buttons: document.querySelectorAll('.nav-button')
};

// –î–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü (–ø—Ä–æ—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)
const pagesData = {
    home: {
        title: 'üè† –ì–ª–∞–≤–Ω–∞—è',
        description: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ'
    },
    roulette: {
        title: 'üé∞ –†—É–ª–µ—Ç–∫–∞',
        description: '–ò—Å–ø—ã—Ç–∞–π—Ç–µ —É–¥–∞—á—É –≤ —Ä—É–ª–µ—Ç–∫–µ'
    },
    tasks: {
        title: '‚úÖ –ó–∞–¥–∞–Ω–∏—è',
        description: '–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –Ω–∞–≥—Ä–∞–¥—ã'
    },
    profile: {
        title: 'üë§ –ü—Ä–æ—Ñ–∏–ª—å',
        description: '–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞'
    }
};

// –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
function changePage(page) {
    // –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
    if (isAnimating || currentPage === page) return;
    
    isAnimating = true;
    currentPage = page;
    
    // –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
    updateActiveButton(page);
    
    // –ü–ª–∞–≤–Ω–∞—è —Å–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    switchContent(page);
    
    // –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
    if (navigator.vibrate) {
        navigator.vibrate(5);
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è)
function updateActiveButton(activePage) {
    elements.buttons.forEach(button => {
        const isActive = button.getAttribute('data-page') === activePage;
        button.classList.toggle('active', isActive);
    });
}

// –°–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
function switchContent(page) {
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
    elements.content.classList.add('content-changing');
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º requestAnimationFrame –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
    requestAnimationFrame(() => {
        // –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        const data = pagesData[page];
        elements.title.textContent = data.title;
        elements.description.textContent = data.description;
        
        // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏
        requestAnimationFrame(() => {
            elements.content.classList.remove('content-changing');
            isAnimating = false;
        });
    });
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏
function showAlert() {
    const messages = {
        home: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é! üè†',
        roulette: '–ö—Ä—É—Ç–∏—Ç–µ —Ä—É–ª–µ—Ç–∫—É –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π—Ç–µ! üé∞',
        tasks: '–ù–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –∂–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è! ‚úÖ',
        profile: '–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–≤–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É! üë§'
    };
    
    tg.showPopup({
        title: '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ',
        message: messages[currentPage] || '–ü—Ä–∏–≤–µ—Ç!',
        buttons: [{ type: 'ok' }]
    });
}

// –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
if (tg.initDataUnsafe.user) {
    const user = tg.initDataUnsafe.user;
    if (user.first_name && currentPage === 'home') {
        elements.title.textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.first_name}! üè†`;
    }
}

// –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ñ–æ–Ω–∞ (–æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤)
let touchEnabled = 'ontouchstart' in window;
if (touchEnabled) {
    document.addEventListener('touchmove', function(e) {
        if (!e.target.closest('.bottom-nav')) {
            e.preventDefault();
        }
    }, { passive: false });
}

console.log('‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Mini App –∑–∞–ø—É—â–µ–Ω!');
